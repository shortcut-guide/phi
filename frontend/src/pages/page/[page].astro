---
import { PinGrid } from "@/f/components/PinGrid";

const page = Number(Astro.params.page || "1");
const limit = 30;
const offset = (page - 1) * limit;

const pins = await fetch(`/api/pins?offset=${offset}`);
const items = await pins.json();
const first = pins?.[0];
const ogImage = first?.imageUrl || '/default-og.jpg';
const ogTitle = `Page ${page} 商品一覧`;
---

<html lang="ja">
  <head>
    <title>{ogTitle}</title>
    <meta name="description" content={`商品一覧 Page ${page}`} />
    <meta property="og:title" content={ogTitle} />
    <meta property="og:description" content="今人気の商品一覧ページです" />
    <meta property="og:image" content={ogImage} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={`https://yourdomain.com/page/${page}`} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={ogTitle} />
    <meta name="twitter:image" content={ogImage} />

    <script type="application/ld+json">
      {JSON.stringify({
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": `商品一覧 Page ${page}`,
        "mainEntity": items.map((p) => ({
          "@type": "Product",
          "name": p.title,
          "image": p.imageUrl,
          "url": `https://yourdomain.com/products/${p.id}`,
        })),
      })}
    </script>
  </head>
  <body class="p-6">
    <h1 class="text-xl font-bold mb-4">ページ {page}</h1>

    <PinGrid items={items} loadMore={() => {}} onSelect={() => {}} />
  </body>
</html>
