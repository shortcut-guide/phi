---
import PaymentMethodList from "@/f/components/PaymentMethodList.astro";
import { messages } from "@/f/config/messageConfig";
import { getLang } from "@/f/utils/lang";
const lang = getLang();
const t = messages.paymentSettingsPage[lang];

const [res1, res2] = await Promise.all([
  fetch("/api/payment"),
  fetch("/api/user/verified")
]);
const { selectedMethod } = await res1.json();
const { isVerified } = await res2.json();

async function save() {
  const selected = (document.querySelector("input[name=payment]:checked") as HTMLInputElement | null)?.value;
  if (selected) {
    await fetch("/api/payment", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ method: selected })
    });
    alert("✅ " + t.setButton + " 完了");
  }
}
---

<h1 class="text-xl font-bold mb-4">{msg.title}</h1>

<PaymentMethodList selectedMethod={selectedMethod} lang={lang} />

<div class="mt-8">
  <button
    class="bg-red-500 text-white px-4 py-2 rounded w-full disabled:bg-gray-400"
    onClick={save}
    disabled={!isVerified}
  >
    {msg.setButton}
  </button>

  {!isVerified && (
    <p class="text-sm text-red-500 mt-2">{msg.notVerifiedWarning}</p>
  )}
</div>
