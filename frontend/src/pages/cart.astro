---
import { paypalClientId } from "@/f/config/paypalConfig";
import { messages } from "@/f/config/messageConfig";
import { useLang } from "@/f/utils/LangProvider";
const lang = useLang();
const t = messages.cartPage[lang];
--- 
<html>
  <head>
    <script src={`https://www.paypal.com/sdk/js?client-id=${paypalClientId}&currency=USD`}></script>
  </head>
  <body>
    <div id="paypal-button-container"></div>

    <script type="module">
      async function initPayPal() {
        try {
          const res = await fetch("/api/csrf");
          const data = await res.json();
          const csrfToken = data.token;

          paypal.Buttons({
            createOrder: async () => {
              const res = await fetch("/api/paypal/create-order", {
                method: "POST",
                headers: {
                  "X-CSRF-Token": csrfToken,
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({ productId: "product-001" })
              });
              const { orderID } = await res.json();
              return orderID;
            },
            onApprove: async (data) => {
              const res = await fetch("/api/paypal/capture-order", {
                method: "POST",
                headers: { 
                  "X-CSRF-Token": csrfToken,
                  "Content-Type": "application/json" 
                },
                body: JSON.stringify({ orderID: data.orderID }),
              });
              const result = await res.json();
              alert(`${t.success}: ${result.status}`);
            },
          }).render("#paypal-button-container");
        } catch (err) {
          console.error("Failed to initialize PayPal Buttons:", err);
        }
      }

      initPayPal();
    </script>
  </body>
</html>