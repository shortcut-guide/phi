---
import { useEffect, useState } from "preact/hooks";
import { tw } from "tw-astasy";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

const [jsonData, setJsonData] = useState(null);

useEffect(() => {
    const fetchData = async () => {
        const res = await fetch(`/api/puppeteer/data/${id}`);
        const result = await res.json();
        setJsonData(result);
    };
    fetchData();
}, [id]);

const handleSave = async () => {
    await fetch(`/api/puppeteer/data/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(jsonData)
    });
    alert("データ更新成功");
};

const editorContainer = tw`
  bg-white shadow-md p-6 rounded-md dark:bg-gray-800
`;
const textAreaStyle = tw`
  w-full h-60 p-2 border border-gray-300 rounded-md font-mono bg-gray-50 dark:bg-gray-700 dark:text-white
`;
const buttonStyle = tw`
  bg-green-500 text-white px-4 py-2 rounded hover:bg-green-700 transition
`;
---

<html>
    <head>
        <title>JSONデータ編集</title>
    </head>
    <body class="bg-gray-100 dark:bg-gray-900 p-6">
        <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-white">JSONデータ編集</h3>
        {jsonData && (
            <div class={editorContainer}>
                <textarea class={textAreaStyle} value={JSON.stringify(jsonData, null, 2)} onInput={(e) => setJsonData(JSON.parse(e.target.value))}></textarea>
                <div class="flex space-x-4 mt-4">
                    <button class={buttonStyle} onClick={handleSave}>保存</button>
                    <a href="/list" class="text-blue-500 hover:underline">戻る</a>
                </div>
            </div>
        )}
    </body>
</html>