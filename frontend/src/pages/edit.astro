---
import { useEffect, useState } from "preact/hooks";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

const [jsonData, setJsonData] = useState(null);

useEffect(() => {
    const fetchData = async () => {
        const res = await fetch(`/api/puppeteer/data/${id}`);
        const result = await res.json();
        setJsonData(result);
    };
    fetchData();
}, [id]);

const handleSave = async () => {
    await fetch(`/api/puppeteer/data/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(jsonData)
    });
    alert("データ更新成功");
};
---

<html>
    <head>
        <title>JSONデータ編集</title>
        <style>
            .editor-container {
                display: grid;
                grid-template-rows: auto 1fr auto;
                gap: 10px;
                padding: 10px;
            }
            textarea {
                width: 100%;
                height: 300px;
                font-family: monospace;
            }
        </style>
    </head>
    <body>
        <h3>JSONデータ編集</h3>
        {jsonData && (
            <div class="editor-container">
                <textarea value={JSON.stringify(jsonData, null, 2)} onInput={(e) => setJsonData(JSON.parse(e.target.value))}></textarea>
                <button onClick={handleSave}>保存</button>
                <a href="/list">戻る</a>
            </div>
        )}
    </body>
</html>