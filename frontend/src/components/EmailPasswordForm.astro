---
const { email, lang } = Astro.props;
const msg = messages.emailPassword[lang ?? "ja"];

const [currentPass, setCurrentPass] = useState("");
const [newPass, setNewPass] = useState("");
const [confirmPass, setConfirmPass] = useState("");

async function update() {
  if (newPass && newPass !== confirmPass) {
    alert(msg.mismatch);
    return;
  }
  await fetch("/api/account/email-password", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, currentPass, newPass })
  });
  alert(msg.success);
}
---

<h1 class="text-xl font-bold mb-4">{msg.title}</h1>

<div>
  <label>{msg.email}</label>
  <input type="email" value={email} disabled class="input" />
  <p class="text-sm text-gray-500">{msg.emailChangeNotice}</p>

  <label class="mt-4">{msg.currentPassword}</label>
  <input type="password" value={currentPass} onInput={e => setCurrentPass(e.target.value)} class="input" />

  <label>{msg.newPassword}</label>
  <input type="password" value={newPass} onInput={e => setNewPass(e.target.value)} class="input" />

  <label>{msg.confirmPassword}</label>
  <input type="password" value={confirmPass} onInput={e => setConfirmPass(e.target.value)} class="input" />

  <p class="text-xs mt-2">{msg.note}</p>

  <button class="mt-4 bg-red-500 text-white px-4 py-2 rounded" onClick={update}>
    {msg.update}
  </button>
</div>
